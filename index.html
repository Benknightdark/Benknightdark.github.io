<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>模仿 Select2 風格的多選下拉選單</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      .dropdown-menu {
        display: none;
        max-height: 200px;
        overflow-y: auto;
      }
      .select-container {
        border: 1px solid #ced4da;
        padding: 0.375rem 0.75rem;
        border-radius: 0.25rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
      }
      .select-container input {
        border: none;
        outline: none;
        flex-grow: 1;
        min-width: 120px;
      }
      .badge {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <div class="dropdown">
        <div class="select-container">
          <input
            type="text"
            id="searchInput"
            autocomplete="off"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            placeholder="開始搜尋..."
          />
        </div>
        <ul class="dropdown-menu w-100" aria-labelledby="searchInput"></ul>
      </div>
    </div>

    <script>
      class Select2Dropdown {
        constructor(options, selector) {
          this.options = options;
          this.container = $(selector);
          this.input = this.container.find("input");
          this.menu = this.container.find(".dropdown-menu");
          this.initEvents();
        }

        initEvents() {
          this.input.on("keyup", () => {
            const searchText = this.input.val();
            this.populateMenu(searchText);
            this.menu.show();
          });

          this.container.on("click", ".dropdown-item", (e) => {
            e.preventDefault();
            const value = $(e.target).text();
            this.addBadge(value);
            this.input.val("").focus();
            this.populateMenu("");
            this.menu.hide();
          });

          this.container.on("click", ".badge", (e) => {
            $(e.target).remove();
          });
        }

        populateMenu(searchText) {
          this.menu.empty();
          const filteredOptions = this.options.filter((option) =>
            option.toLowerCase().includes(searchText.toLowerCase())
          );
          filteredOptions.forEach((option) => {
            this.menu.append(
              `<li><a class="dropdown-item" href="#">${option}</a></li>`
            );
          });
        }

        addBadge(value) {
          const badge = $(
            `<span class="badge bg-primary">${value}<span class="ms-2">&times;</span></span>`
          );
          badge.insertBefore(this.input);
        }
      }

      $(document).ready(() => {
        const options = ["選項 1", "選項 2", "選項 3", "選項 4"];
        const dropdown = new Select2Dropdown(options, ".dropdown");
      });
    </script>
  </body>
</html>
